<!DOCTYPE html>
<html>
  <head>
    <title>y86 Simulator</title>
    <link rel="stylesheet" href="css/codemirror.css">
    <link rel="stylesheet" href="css/index.css">
  </head>
  <body>
    <h1>y86 Simulator</h1>
        
    <div id="app"></div>

<script type="text/template" id="default_y86_code"># Execution begins at address 0
.pos 0
init:
    irmovl Stack, %esp # Setup stack pointer
    irmovl Stack, %ebp # Set up base pointer
    call Main # Execute main program
    halt # Terminate program

# Array of 4 elements
.align 4
array:
    .long 0xd
    .long 0xc0
    .long 0xb00
    .long 0xa000

Main:
    pushl %ebp
    rrmovl %esp,%ebp
    irmovl $4,%eax
    pushl %eax # Push 4
    irmovl array,%edx
    pushl %edx # Push array
    call Sum # Sum(array, 4)
    rrmovl %ebp,%esp
    popl %ebp
    ret

# int Sum(int *Start, int Count)
Sum:
    pushl %ebp
    rrmovl %esp,%ebp
    mrmovl 8(%ebp),%ecx # ecx = Start
    mrmovl 12(%ebp),%edx # edx = Count
    xorl %eax,%eax # sum = 0
    andl %edx,%edx # Set condition codes
    je End
Loop:
    mrmovl (%ecx),%esi # get *Start
    addl %esi,%eax # add to sum
    irmovl $4,%ebx #
    addl %ebx,%ecx # Start++
    irmovl $-1,%ebx #
    addl %ebx,%edx # Count--
    jne Loop # Stop when 0
End:
    rrmovl %ebp,%esp
    popl %ebp
    ret

# The stack starts here and grows to lower addresses
.pos 0x100
Stack:</script>

    <script type="text/template" id="tmpl_app">
        <div class="actions">
            <button class="run">Run</button>
            <button class="step">Step</button>
            <button class="pause">Pause</button>
        </div>
        <div class="editor"></div>
        <div class="inspector"></div>
    </script>

    <script type="text/template" id="tmpl_editor">
        <textarea class="code"><%= code %></textarea>
    </script>

    <script type="text/template" id="tmpl_inspector">
        <div class="object"></div>
        <div class="memory"></div>
        <div class="registers-wrapper"></div>
    </script>

    <script type="text/template" id="tmpl_object_code">
        <h2>Object code</h2>
        <div class="lines"></div>
    </script>

    <script type="text/template" id="tmpl_object_code_line">
        <div class="line-no"><%= lineno %></div>
        <div class="binary"><%= binary %></div>
        <div class="source"><%= source %></div>
    </script>

    <script type="text/template" id="tmpl_mem_byte">
        <div class="address"><%= address %></div>
        <div class="value"><%= value %></div>
    </script>

    <script type="text/template" id="tmpl_registers">
        <div class="register">
            <div class="label">%eax</div>
            <div class="value"><%= eax %></div>
        </div>
        <div class="register">
            <div class="label">%ecx</div>
            <div class="value"><%= ecx %></div>
        </div>
        <div class="register">
            <div class="label">%ebx</div>
            <div class="value"><%= ebx %></div>
        </div>
        <div class="register">
            <div class="label">%edx</div>
            <div class="value"><%= edx %></div>
        </div>
        <div class="register">
            <div class="label">%ebp</div>
            <div class="value"><%= ebp %></div>
        </div>
        <div class="register">
            <div class="label">%esp</div>
            <div class="value"><%= esp %></div>
        </div>
        <div class="register">
            <div class="label">%esi</div>
            <div class="value"><%= esi %></div>
        </div>
        <div class="register">
            <div class="label">%edu</div>
            <div class="value"><%= edu %></div>
        </div>
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>

    <script src="js/codemirror-compressed.js"></script>

    <script src="js/y86.js"></script>
    <script src="js/assem.js"></script>
    <script src="js/instr.js"></script>
    <script src="js/general.js"></script>
    <script src="js/syntax.js"></script>

    <script src="js/views/app.js"></script>
    <script src="js/views/editor.js"></script>
    <script src="js/views/inspector.js"></script>
    <script src="js/views/membyte.js"></script>
    <script src="js/views/registers.js"></script>
    <script src="js/views/objcode.js"></script>

    <script>
        // var source = CodeMirror.fromTextArea($('#y86').get(0));

        // //Assemble when button is clicked
        // $('#assem').click(function(){
        //  var assembled = ASSEMBLE($('#y86').val());
        //  $('#assembled').val(assembled);
        // });

        // $('#exec').click(function(){
        //  var result = toByteArray($('#assembled').val()),
        //      registers = '';
        //  result = EXECUTE(result);
        //  registers = reg2str(REG);
    
        //  $('#result').val(registers + '\n' + result);
        // });

        // $('#assemexec').click(function(){
        //  $('#assem').click();
        //  $('#exec').click(); 
        // });
        $(function () {
            var app = new AppView();
            $('#app').append(app.$el);
        });
    </script>

  </body>
</html>


